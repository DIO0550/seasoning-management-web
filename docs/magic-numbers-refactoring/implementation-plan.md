# マジックナンバー定数化 実装計画

## プロジェクト概要

現在のプロジェクトに散在するマジックナンバーを特定し、適切な定数として管理することで、コードの保守性と可読性を向上させる。

## 課題の現状分析

### 発見されたマジックナンバー

#### 1. バリデーション制限値

- **調味料名**: 20 文字制限（複数箇所で使用）
- **テンプレート名**: 20 文字制限
- **テンプレート説明**: 200 文字制限
- **調味料種類名**: 50 文字制限
- **画像サイズ**: 5MB 制限

#### 2. データベース接続設定

- **接続プール数**:
  - 本番環境: 10
  - 開発環境: 5
  - テスト環境: 3
- **タイムアウト値**:
  - 本番環境: 60000ms
  - 開発環境: 30000ms

#### 3. ページネーション

- **デフォルト件数**: 10 件

#### 4. その他の制限値

- **画像バイト計算**: 1024 \* 1024 (MB 換算)

## アーキテクチャ方針

### 定数管理の原則

1. **単一責任の原則**: 各定数ファイルは特定のドメインまたは機能に関連する定数のみを管理
2. **可読性**: 定数名は用途が明確に分かるようにする
3. **再利用性**: 同じ値が複数箇所で使用される場合は必ず定数化
4. **型安全性**: TypeScript の型システムを活用

### ディレクトリ構成

```
src/constants/
├── validation/
│   ├── nameValidation.ts      # 名前系バリデーション定数
│   ├── descriptionValidation.ts # 説明系バリデーション定数
│   └── imageValidation.ts     # 画像系バリデーション定数
├── database/
│   ├── connectionLimits.ts   # DB接続制限定数
│   └── timeouts.ts           # タイムアウト関連定数
└── pagination.ts             # ページネーション定数
```

## 実装戦略

### Phase 1: バリデーション定数の整理

#### 目的

- 各種バリデーションで使用されているマジックナンバーを定数化
- 既存の `validation.ts` との整合性を保ちながら拡張

#### 対象ファイル

- `src/features/template/utils/nameValidationMessage.ts`
- `src/features/template/utils/descriptionValidationMessage.ts`
- `src/utils/seasoningTypeNameValidation.ts`
- `src/utils/templateNameValidation.ts`
- `src/utils/templateDescriptionValidation.ts`

### Phase 2: データベース設定定数の整理

#### 目的

- データベース接続設定のマジックナンバーを定数化
- 環境別設定の管理を改善

#### 対象ファイル

- `src/config/database.ts`

### Phase 3: その他システム定数の整理

#### 目的

- ページネーションやその他のシステム設定値を定数化

#### 対象ファイル

- ページネーション関連のファイル
- その他マジックナンバーが発見されたファイル

### Phase 4: 既存定数との統合

#### 目的

- 既存の `validation.ts` との重複を解消
- 一貫した定数管理体制の確立

## 品質保証

### テスト戦略

- 定数変更前後での動作確認
- 既存テストの実行で回帰テスト
- 新しい定数ファイルのユニットテスト作成

### コードレビューポイント

- 定数名の適切性
- 型安全性の確保
- 既存機能への影響確認

## 期待される効果

### 短期的効果

- コードの可読性向上
- マジックナンバーの撲滅
- 設定値の一元管理

### 長期的効果

- 保守性の向上
- 設定変更時の影響範囲の最小化
- 新規開発時の効率向上

## リスク管理

### 潜在的リスク

1. **既存機能への影響**: 定数化による予期しない動作変更
2. **テストの更新漏れ**: テストコード内のマジックナンバー更新漏れ
3. **命名の一貫性**: チーム内での命名規則の統一不足

### 対策

1. **段階的実装**: 小さな単位での変更とテスト
2. **包括的テスト**: 自動テストによる回帰確認
3. **命名規則の策定**: 事前の命名規則合意
